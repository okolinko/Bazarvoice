<?php
if ($currentProduct = $this->getCurrentProduct()) {
  $sku = $currentProduct->getSku();

  $sku_array = array(
                'FIBERS-CA' => 'FIBERS',
                'BBF-ca' => 'BBF',
                '20504231' => 'FHS4B',
                '20080136' => 'TTS',
                '20080131' => 'TSA4C',
                '20080130' => 'OPTE4',
                '20080164' => 'PKIT20010',
                'STR-ca' => 'STR'
            );

            $sku = isset($sku_array[$sku]) ? $sku_array[$sku] : $sku;
}
$array_reviews = $this->getMyCustomMethod()->addFieldToFilter('sku', $sku)->addFieldToFilter('type_text', 'reviews')->getData();
$array_reviewcomments = $this->getMyCustomMethod()->addFieldToFilter('sku', $sku)->addFieldToFilter('type_text', 'reviewcomments')->getData();

$rating = $this->getMyCustomMethod()->addFieldToFilter('sku', $sku)->addFieldToFilter('type_text', 'product')->getData();

$questions_sum = count($this->getMyCustomMethod()->addFieldToFilter('sku', $sku)->addFieldToFilter('type_text', 'questions')->getData());
$answers_sum = count($this->getMyCustomMethod()->addFieldToFilter('sku', $sku)->addFieldToFilter('type_text', 'answers')->getData());

if (!empty($rating[0]['statistic'])) {
  $statistic = json_decode($rating[0]['statistic'], true);
  $rat = $statistic['RatingDistribution'];
  $rating_general = array_fill(1, 5, 0);
  $reviews_sum = 0;
  foreach ($rat as $value) {
    $rating_general[$value['RatingValue']] = $value['Count'];
    $reviews_sum += $value['Count'];
  }
}
else {
	$rat = 0;
  	$rating_general = 0;
  	$reviews_sum = 0;
}
?>
<script>
  require(['jquery', 'jquery/ui'], function($){
    $(document).ready( function() {
      let array_reviews = <?php echo json_encode($array_reviews); ?>;
      let array_reviewcomments = <?php echo json_encode($array_reviewcomments); ?>;
      let array_reviews_filtered = [];
      let items_quantity = 8;
      let current_page = 1;
      let current_year = new Date().getFullYear();

      renderReviews(array_reviews, array_reviewcomments, items_quantity, current_page);

      let comment_form = `<div class="bv-inline-form-container">
    <div id="bv-mboxzone-commentSubmission1_inline" class="bv-mboxzone bv-mbox-opened" style="top: 2506.38px !important; left: 382px !important; height: auto !important;">
        <div class="bv-mbox-inner bv-core-container-103 bv-mbox-commentSubmission1_inline" role="region" aria-label="">
            <div class="bv-mbox-wrapper bv-mbox-secondary-content bv-mbox-content-submission-comment bv-mbox-narrow bv-mbox-over bv-mbox-inline">
                <div id="bv-mbox-commentSubmission1_inline-list" class="bv-mbox">
                    <button type="button" name="Cancel" class="bv-mbox-close bv-focusable custom-commentform-close" tabindex="0" >
                        <span aria-hidden="true"> ✘ </span>
                        <span id="bv-mbox-close-label" class="bv-off-screen">Close</span>
                    </button>
                    <div class="bv-mbox-sidebar"></div>
                    <div class="bv-mbox-content-container">
                        <h2 class="bv-mbox-breadcrumb">
                            <span class="bv-mbox-breadcrumb-item" id="bv-mbox-breadcrumb-item">
                                <span>Post Comment</span>
                            </span>
                        </h2>

                        <div class="bv-mbox-injection-container" style="height: 551px !important;">
                            <div class="bv-mbox-injection-target bv-mbox-current">
                                <div class="bv-submission bv-submission-noimage bv-fake-inline">
                                    <div class="bv-compat">
                                        <form id="bv-submitcomment-review" action="" accept-charset="utf-8" method="POST" class="bv-form">
                                        <input type="hidden" name="passkey" value="b5xjo1fw42ctw528lazc88mz8" class="bv-noremember">
                                        <input type="hidden" name="action" value="submit" class="bv-noremember"> <input type="hidden" name="apiversion" value="5.5" class="bv-noremember"> <input type="hidden" name="callback" value="parent.rpc.returnSubmissionResponse" class="bv-noremember">
                                        <input type="hidden" name="reviewid" value="212089419" class="bv-noremember">
                                        <input type="hidden" name="campaignid" value="BV_REVIEW_DISPLAY" class="bv-noremember">
                                        <input type="hidden" name="fp" value="" class="bv-noremember">
                                        <input type="hidden" name="forceutf8" value="☠" class="bv-noremember"> <input type="hidden" name="locale" value="en_US" class="bv-noremember"> <input type="hidden" name="contextdatavalue_VerifiedPurchaser" value="False" class="bv-noremember">
                                        <input type="hidden" name="displaycode" value="18542-en_us" class="bv-noremember">
                                        <input type="hidden" name="hostedauthentication_callbackUrl" value="https://www.toppik.com/shop/hair-perfecting-tool-kit/" class="bv-noremember"> <input type="hidden" name="sendemailalertwhenpublished" class="bv-noremember bv-form-ignore" value="true">
                                        <input type="hidden" name="sendemailalertwhencommented" class="bv-noremember bv-form-ignore" value="true">
                                        <input type="hidden" name="sendemailalertwhenanswered" class="bv-noremember bv-form-ignore" value="true">
                                            <div class="bv-submission-section">
                                                 <span id="bv-required-text">
                                                    <p class="bv-required-fields-text">Required fields are marked with *</p>
                                                </span>
                                                <span class="bv-off-screen" id="bv-required-text-reader">Required field</span>
                                                <div class="bv-fieldsets bv-input-fieldsets">
                                                    <fieldset class="bv-fieldset bv-fieldset-commenttext bv-textarea-field bv-mincount">
                                                        <div class="bv-fieldset-arrowicon"></div>
                                                        <div class="bv-fieldset-inner"> <label for="bv-textarea-field-commenttext" class="bv-fieldset-label-wrapper"> <span class="bv-fieldset-label"> <span class="bv-fieldset-label-text"> Comment* </span> <span aria-hidden="false" class="bv-off-screen bv-field-aria-validation">Error: Required.</span> </span> <span class="bv-off-screen">Maximum of 10000 characters.</span> </label> <span class="bv-helper"> <span class="bv-helper-label">Required</span> <span class="bv-helper-icon" aria-hidden="true"> <span class="bv-helper-icon-positive"> ✔ </span> <span class="bv-helper-icon-negative"> ✘ </span> </span> </span> <textarea id="bv-textarea-field-commenttext" aria-describedby="bv-required-text" class="bv-text bv-focusable " name="commenttext" maxlength="10000" placeholder="Write a comment..." required="" aria-required="true" tabindex="0" style="overflow-wrap: break-word; overflow: hidden !important; height: 90px !important;" aria-invalid="true"></textarea> </div>
                                                    </fieldset>
                                                    <fieldset class="bv-fieldset bv-fieldset-usernickname bv-text-field bv-fieldset-small bv-mincount">
                                                        <div class="bv-fieldset-arrowicon"></div>
                                                        <div class="bv-fieldset-inner"> <label for="bv-text-field-usernickname" class="bv-fieldset-label-wrapper"> <span class="bv-fieldset-label"> <span class="bv-fieldset-label-text"> Nickname* </span> <span aria-hidden="false" class="bv-off-screen bv-field-aria-validation">Error: Required.</span> </span> <span class="bv-off-screen">Maximum of 25 characters.</span> </label> <span class="bv-helper"> <span class="bv-helper-label" role="status" aria-live="polite">Required</span> <span class="bv-helper-icon" aria-hidden="true"> <span class="bv-helper-icon-positive"> ✔ </span> <span class="bv-helper-icon-negative"> ✘ </span> </span> </span> <input autocomplete="nickname" id="bv-text-field-usernickname" class="bv-text bv-focusable " type="text" name="usernickname" maxlength="25" placeholder="Example: jackie27" value="" required="" aria-required="true" tabindex="0" aria-invalid="true"> </div>
                                                    </fieldset>
                                                    <fieldset class="bv-fieldset bv-fieldset-userlocation bv-text-field bv-nocount bv-fieldset-small">
                                                        <div class="bv-fieldset-arrowicon"></div>
                                                        <div class="bv-fieldset-inner"> <label for="bv-text-field-userlocation" class="bv-fieldset-label-wrapper"> <span class="bv-fieldset-label"> <span class="bv-fieldset-label-text"> Location </span> <span aria-hidden="false" class="bv-off-screen bv-field-aria-validation">Field input is valid.</span> </span> <span class="bv-off-screen">Maximum of 255 characters.</span> </label> <span class="bv-helper"> <span class="bv-helper-label"></span> <span class="bv-helper-icon" aria-hidden="true"> <span class="bv-helper-icon-positive"> ✔ </span> <span class="bv-helper-icon-negative"> ✘ </span> </span> </span> <input id="bv-text-field-userlocation" class="bv-text bv-focusable " type="text" name="userlocation" maxlength="255" placeholder="Example: New York, NY" value="" tabindex="0"> </div>
                                                    </fieldset>
                                                    <fieldset class="bv-fieldset bv-fieldset-hostedauthentication_authenticationemail bv-email-field bv-fieldset-small-alone ">
                                                        <div class="bv-fieldset-arrowicon"></div>
                                                        <div class="bv-fieldset-inner"> <label for="bv-email-field-hostedauthentication_authenticationemail" class="bv-fieldset-label-wrapper"> <span class="bv-fieldset-label"> <span class="bv-fieldset-label-text"> Email* </span> <span aria-hidden="false" class="bv-off-screen bv-field-aria-validation">Error: Required.</span> </span> <span class="bv-off-screen">Maximum of 255 characters.</span> </label> <span class="bv-helper"> <span class="bv-helper-label" id="bv-invalid-email-for-aria-describedby">Required</span> <span class="bv-helper-icon" aria-hidden="true"> <span class="bv-helper-icon-positive"> ✔ </span> <span class="bv-helper-icon-negative"> ✘ </span> </span> </span> <input autocomplete="email" id="bv-email-field-hostedauthentication_authenticationemail" class="bv-text bv-focusable bv-email" type="email" name="hostedauthentication_authenticationemail" maxlength="255" placeholder="Example: youremail@example.com" value="" required="" aria-required="true" aria-describedby="bv-invalid-email-for-aria-describedby" tabindex="0" aria-invalid="true"> </div>
                                                    </fieldset>
                                                </div>
                                                <div class="bv-fieldsets bv-fieldsets-actions">
                                                    <div class="bv-form-actions bv-fieldset">
                                                        <div class="bv-fieldset-arrowicon"></div>
                                                        <div class="bv-fieldset-inner">
                                                            <div class="bv-actions-container">
                                                                <p id="bv-casltext-comment" class="bv-fieldset-casltext">You may receive emails regarding this submission. Any emails will include the ability to opt-out of future communications.</p>
                                                                <button type="button" aria-label="Post Comment" aria-describedby="bv-casltext-comment" class="bv-form-actions-submit bv-submit bv-focusable bv-submission-button-submit" name="bv-submit-button" tabindex="0" id="post-comment">Post Comment</button>
                                                                <button type="button" class="bv-form-action bv-cancel bv-submission-button-submit">Cancel</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>`;

      /****************** handlers *********************/

      /****************** next/prev page *********************/
      $('.custom-review-link-prev').on('click', function(e){
        e.preventDefault();
        if(current_page > 1) {
          current_page--;
          if(array_reviews_filtered.length > 0) {
            renderReviews(array_reviews_filtered, array_reviewcomments, items_quantity, current_page)
          } else {
            renderReviews(array_reviews, array_reviewcomments, items_quantity, current_page);
          }
        }
      });
      $('.custom-review-link-next').on('click', function(e){
        e.preventDefault();
        let length = array_reviews_filtered.length > 0 ? array_reviews_filtered.length : array_reviews.length;
        if(items_quantity * current_page <= length) {
          current_page++;
          if(array_reviews_filtered.length > 0) {
            renderReviews(array_reviews_filtered, array_reviewcomments, items_quantity, current_page)
          } else {
            renderReviews(array_reviews, array_reviewcomments, items_quantity, current_page);
          }
        }
      });

      /****************** review dropdown menu *********************/
      $('#bv-dropdown-select-reviews').parent().on('mouseenter',function(){
        $('#reviews-custom-sortby').removeClass('hide-custom-block').addClass('show-custom-block');
      });
      $('#bv-dropdown-select-reviews, .bv-dropdown').on('mouseleave',function(){
        $('#reviews-custom-sortby').removeClass('show-custom-block').addClass('hide-custom-block');
      });

      /****************** review filters dropdown menu *********************/
      dropdownMenu($('.bv-dropdown[data-bv-filter-for="Rating"]'), $('#bv-content-filter-dropdown-Rating'));
      dropdownMenu($('.bv-dropdown[data-bv-filter-for="My hair loss:"]'), $('#bv-content-filter-dropdown-SeverityOfLoss'));
      dropdownMenu($('.bv-dropdown[data-bv-filter-for="Salon Professional:"]'), $('#bv-content-filter-dropdown-SalonProfessional'));

      /****************** show/hide filters *********************/
      $('.bv-filter-control-custom').on('click', function(){
        if($('#bv-custom-filters').hasClass('show')) {
          $('#bv-custom-filters').removeClass('show');
        } else {
          $('#bv-custom-filters').addClass('show');
        }
      });

      /****************** show/hide comment form *********************/
      $('.custom-list-reviews').on('click', '.custom-comment-button', function (e) {
        e.preventDefault();
        $('.bv-inline-form-container').remove();
        $($(this).closest('div.bv-content-actions-container')[0]).after(comment_form);
      });
      $('.custom-list-reviews').on('click', '.custom-commentform-close', function (e) {
        e.preventDefault();
        $('.bv-inline-form-container').remove();
      });

      /****************** sort by parameters *********************/
      $('#bv-dropdown-select-reviews-sortby').children().on('click', function () {
        sortBy(array_reviews, $(this).data('bv-dropdown-value'));
        $(this).siblings().removeClass('bv-dropdown-item-selected');
        $(this).addClass('bv-dropdown-item-selected');
        $('#bv-dropdown-title-reviews').text($(this).text());
      });

      /****************** filters from hidden menu *********************/
      $('.bv-active-filters-list li').not(':last-child').on('click', function(){
        $(this).addClass('bv-hidden');
        let type = $(this).data('bv-filter-headerid');
        let option = $(this).children().data('bv-filter-option');
        $('[data-bv-filter-for="' + type + '"]').find('li[data-bv-dropdown-value="' + option + '"]').removeClass('bv-dropdown-item-selected');
        let ratings = [];
        let severities = [];
        let professionality = [];
        $('#bv-content-filter-dropdown-Rating li').each(function (index, value) {
          if($(value).hasClass('bv-dropdown-item-selected')) ratings.push($(value).data('bv-dropdown-value'));
        });
        $('#bv-content-filter-dropdown-SeverityOfLoss li').each(function (index, value) {
          if($(value).hasClass('bv-dropdown-item-selected')) severities.push($(value).data('bv-dropdown-value'));
        });
        $('#bv-content-filter-dropdown-SalonProfessional li').each(function (index, value) {
          if($(value).hasClass('bv-dropdown-item-selected')) professionality.push($(value).data('bv-dropdown-value'));
        });
        array_reviews_filtered = filterBy(array_reviews, ratings, severities, professionality);
      });

      /****************** filters from drop down menu *********************/
      $('#bv-custom-filters .bv-dropdown-container li').on('click', function(){
        let ratings = [];
        let severities = [];
        let professionality = [];
        if($(this).hasClass('bv-dropdown-item-selected')) {
          $(this).removeClass('bv-dropdown-item-selected');
        } else {
          $(this).addClass('bv-dropdown-item-selected');
        };
        $('#bv-content-filter-dropdown-Rating li').each(function (index, value) {
          if($(value).hasClass('bv-dropdown-item-selected')) {
            ratings.push($(value).data('bv-dropdown-value'));
            $('button[title="Rating"][data-bv-filter-option="' + $(value).data('bv-dropdown-value') + '"]').parent().removeClass('bv-hidden');
          } else {
            $('button[title="Rating"][data-bv-filter-option="' + $(value).data('bv-dropdown-value') + '"]').parent().addClass('bv-hidden');
          }
        });
        $('#bv-content-filter-dropdown-SeverityOfLoss li').each(function (index, value) {
          if($(value).hasClass('bv-dropdown-item-selected')) {
            severities.push($(value).data('bv-dropdown-value'));
            $('button[title="My hair loss:"][data-bv-filter-option="' + $(value).data('bv-dropdown-value') + '"]').parent().removeClass('bv-hidden');
          } else {
            $('button[title="My hair loss:"][data-bv-filter-option="' + $(value).data('bv-dropdown-value') + '"]').parent().addClass('bv-hidden');
          }
        });
        $('#bv-content-filter-dropdown-SalonProfessional li').each(function (index, value) {
          if($(value).hasClass('bv-dropdown-item-selected')) {
            professionality.push($(value).data('bv-dropdown-value'));
            $('button[title="Salon Professional:"][data-bv-filter-option="' + $(value).data('bv-dropdown-value') + '"]').parent().removeClass('bv-hidden');
          } else {
            $('button[title="Salon Professional:"][data-bv-filter-option="' + $(value).data('bv-dropdown-value') + '"]').parent().addClass('bv-hidden');
          }
        });
        array_reviews_filtered = filterBy(array_reviews, ratings, severities, professionality);
      });

      /****************** clear filters from hidden menu *********************/
      $('.bv-active-filter-button-clear').on('click', function(){
        $('#bv-custom-filters .bv-dropdown-container li').removeClass('bv-dropdown-item-selected');
        $('#bv-custom-filters .bv-active-filters-list li').not(':last-child').addClass('bv-hidden');
        array_reviews_filtered = filterBy(array_reviews);
      });

      /****************** show/hide search results *********************/
      function clearSearch(){
      	$('.bv-fieldset-questionsummary').removeClass('bv-valid');
      	$('.bv-fieldset-questionsummary').removeClass('bv-error');
        $('.bv-fieldset-usernickname').removeClass('bv-valid');
        $('.bv-fieldset-usernickname').removeClass('bv-error');
        $('.bv-fieldset-hostedauthentication_authenticationemail').removeClass('bv-valid');
        $('.bv-fieldset-hostedauthentication_authenticationemail').removeClass('bv-error');
        $("#bv-text-review-search-field-userlocation").val("");
        $("#bv-textarea-review-search-field-questionsummary").val("");
        $("#bv-text-revies-search-field-usernickname").val("");
        $("#bv-email-field-review-search-hostedauthentication_authenticationemail").val("");
        $("#bv-text-field-search-contentSearch1-lightboxSearch").val("");
      }
      $(".bv-ask-question").click(function(e){
      	clearSearch();
      });
      $('#custom-reviews .bv-content-search-btn').click(function() {
        if($('#bv-text-field-search-contentSearch1').val() != '') {
        	clearSearch();
        	var popup_id = $('#' + $(this).attr('rel'));
        	$(popup_id).show();
        	$('.review_overlay_popup').show();
        	$('#review_search_results').css('top', $(window).scrollTop());
        	searchBy($('#bv-text-field-search-contentSearch1').val());
        }
      });
      $('#review_search_results .bv-content-search-btn').on('click', function () {
        if($('#bv-text-field-search-contentSearch1-lightboxSearch').val() != '') {
         	var popup_id = $('#' + $(this).attr('rel'));
         	$(popup_id).show();
         	$('.review_overlay_popup').show();
          	searchBy($('#bv-text-field-search-contentSearch1-lightboxSearch').val());
        }
      });
      $('#bv-text-field-search-contentSearch1').keyup(function(event){
        if($(this).val() != '') {
          if(event.keyCode == 13){
          	clearSearch();
            event.preventDefault();
            var popup_id = $('#review_search_results');
            $(popup_id).show();
            $('.review_overlay_popup').show();
            $('#review_search_results').css('top', $(window).scrollTop());
            searchBy($('#bv-text-field-search-contentSearch1').val());
          }
        }
      });
      $('#bv-text-field-search-contentSearch1-lightboxSearch').keyup(function(event){
        if($(this).val() != '') {
          if(event.keyCode == 13){
            event.preventDefault();
            var popup_id = $('#review_search_results');
            $(popup_id).show();
            $('.review_overlay_popup').show();
            searchBy($('#bv-text-field-search-contentSearch1-lightboxSearch').val());
          }
        }
      });

      $('.review_overlay_popup, #review_search_results .bv-mbox-close').click(function() {
        $('.review_overlay_popup, .bv-custom-review-popup').hide();
      });
      /****************** functions *********************/
      function dropdownMenu(hover_block, menu_block){
        hover_block.hover(
          function(){
            menu_block.removeClass('hide-custom-block').addClass('show-custom-block');
          },function(){
            menu_block.removeClass('show-custom-block').addClass('hide-custom-block');
          }
        );
      }
      function sortBy(array_reviews, sort_parameter) {
        array_reviews_sort = array_reviews.sort(function(a, b){
          if(sort_parameter == 'relevancy') {
            return JSON.parse(b.statistic).Votes - JSON.parse(a.statistic).Votes;
          }
          if(sort_parameter == 'positive') {
            return b.rating - a.rating;
          }
          if(sort_parameter == 'negative') {
            return a.rating - b.rating;
          }
          if(sort_parameter == 'mostRecent') {
            return b.data.slice(0, 4) - a.data.slice(0, 4);
          }
        });
        renderReviews(array_reviews_sort, array_reviewcomments, items_quantity, current_page);
      };
      function filterBy(array_reviews, ratings = [], severities = [], professionality = []) {
        const array_reviews_filtered = array_reviews.filter(function(item){
          if(ratings.length > 0) {
            for (var i = 0; i < ratings.length; i++) {
              if (item.rating == ratings[i]) return item;
            }
          } else return item;
        }).filter(function(item){
          if(severities.length > 0) {
            let context_data_values = JSON.parse(item.context_data_values);
            let current_severity = context_data_values.SeverityOfLoss;
            if(current_severity) {
              for(var i = 0; i < severities.length; i++) {
                if(current_severity.Value == severities[i]) {
                  return item;
                } else return false;
              }
            } else return false;
          } else return item;
        }).filter(function(item){
          if(professionality.length > 0) {
            let context_data_values = JSON.parse(item.context_data_values);
            let current_professionality = context_data_values.SalonProfessional;
            if(current_professionality) {
              for(var i = 0; i < professionality.length; i++) {
                if(current_professionality.Value == professionality[i]) {
                  return item;
                } else return false;
              }
            } else return false;
          } else return item;
        });

        if((ratings.length == 0) && (severities.length == 0) && (professionality.length == 0)) {
          $('#bv-custom-filters > .bv-active-filters').removeClass('bv-show').addClass('bv-hidden');
        } else {
          $('#bv-custom-filters > .bv-active-filters').removeClass('bv-hidden').addClass('bv-show');
        }

        if(array_reviews_filtered.length > 0) {
          renderReviews(array_reviews_filtered, array_reviewcomments, items_quantity, current_page);
          return array_reviews_filtered;
        } else {
          if((ratings.length > 0) || (severities.length > 0) || (professionality.length > 0)) {
            array_reviews_filtered.length = 0;
            renderReviews([], array_reviewcomments, items_quantity, current_page);
          } else {
            array_reviews_filtered.length = 0;
            renderReviews(array_reviews, array_reviewcomments, items_quantity, current_page);
          }
        }
      }
      function searchBy(search_text = ''){
        search_text = search_text.toLowerCase();
        $('.bv-content-search-results').addClass('bv-content-search-results__no-results');
        $('.popup-custom-search-results').html('');
        let array_searched = array_reviews.filter(function(item) {
          if (item.title_text && item.title_text.toLowerCase().indexOf(search_text) != -1) {
            return item;
          }
          if (item.text && item.text.toLowerCase().indexOf(search_text) != -1) {
            return item;
          }
        });
        if(array_searched.length > 0) {
          let search_result = renderSearchReview(array_searched, array_reviewcomments);
          $('.popup-custom-search-results').html(search_result);
        } else {
          $('#bv-search-results-count').html('');
          $('.bv-content-search-results').removeClass('bv-content-search-results__no-results');
        }
      }
      function renderSearchReview(array_reviews, array_reviewcomments) {
        let reviews = [];
        let reviewcomments = [];
        let item;
        let gender = '';
        let gender_symbol = '';
        $.each(array_reviews, function(index, value) {
          array_reviewcomments.filter(function(el) {     //Find all comments for current review
            if (value.id == el.id) {
              gender = (typeof(el.Gender) !== 'undefined') ? el.Gender.Value : 'Male';
              gender_symbol = (gender == 'Male') ? '♂' : '♀';
              item =
                `<li class="bv-content-item bv-secondary-content-comment bv-secondary-content-item" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
                  <div class="bv-content-item-avatar-offset bv-content-item-avatar-offset-on">
                    <div class="bv-content-container">
                      <div class="bv-content-core ">
                        <div class="bv-content-header">
                          <div class="bv-author-avatar">
                            <span title="Avatar image" class="bv-author-no-avatar bv-author-gender-" aria-hidden="true">
                              ${gender_symbol}
                            </span>
                          </div>
                          <div class="bv-content-data-summary">
                            <div class="bv-content-header-meta">
                              <div class="bv-content-meta-wrapper">
                                <div class="bv-content-meta" role="presentation">
                                  <div class="bv-content-reference-data bv-content-author-name">
                                    <div class="bv-author">
                                      <span class="bv-author" itemprop="creator">
                                        ${el.name}
                                      </span>
                                    </div>
                                    <div class="bv-content-datetime" role="presentation">
                                      <meta itemprop="dateCreated" content="2020-03-15">
                                      <meta itemprop="datePublished" content="2020-03-15">
                                      <span class="bv-content-datetime-dot" aria-hidden="true">·</span> <span class="bv-content-datetime-stamp"> ago</span>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="bv-content-details-offset-off">
                          <div class="bv-content-summary">
                            <div class="bv-content-summary-body" itemprop="text">
                              <div class="bv-content-summary-body-text">
                                <p>${el.text}</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
              </li>`;
              reviewcomments.push(item);
            }
          });
          let context_data_values = JSON.parse(value.context_data_values);
          gender = (typeof(context_data_values.Gender) !== 'undefined') ? context_data_values.Gender.Value : 'Male';
          gender_symbol = (gender == 'Male') ? '♂' : '♀';
          let years_ago = (current_year - value.data.slice(0, 4) > 1) ? current_year - value.data.slice(0, 4) + ' years ago' : 'a year ago';

          item =
            `<li class="bv-content-item bv-content-top-review bv-content-review" itemprop="review" itemscope="" itemtype="http://schema.org/Review" data-content-id="Reviews-${value.id}">
                <div class="bv-content-item-avatar-offset bv-content-item-avatar-offset-off">
        <div class="bv-content-container">
            <div class="bv-content-core bv-content-core-float">
                <div class="bv-content-header">
                    <div class="bv-content-data-summary">
                        <div class="bv-content-header-meta">
                          <span class="bv-content-rating bv-rating-ratio" itemprop="reviewRating" itemscope="" itemtype="http://schema.org/Rating">
                                <meta itemprop="ratingValue" content="${value.rating}">
                                <meta itemprop="bestRating" content="5">
                                 <span class="bv-rating-stars-container">
                                  <abbr title="${value.rating} out of 5 stars." class="bv-rating bv-rating-stars bv-rating-stars-off" aria-hidden="true"> ★★★★★ </abbr>
                                  <abbr title="${value.rating} out of 5 stars." class="bv-rating-max bv-rating-stars bv-rating-stars-on bv-width-from-rating-stats-${value.rating * 20}" aria-hidden="true"> ★★★★★ </abbr>
                                  <span class="bv-off-screen">${value.rating} out of 5 stars.</span>
                                 </span>
                            </span>
                            <div class="bv-content-meta-wrapper">
                                <div class="bv-content-meta" role="presentation">
                                    <div class="bv-content-reference-data bv-content-author-name">
                                      <span class="bv-author">
                                            <span class="bv-avatar-author-name" itemprop="author">
                                             <span>${value.name}</span>
                                         </span>
                                        </span>
                                        <div class="bv-content-datetime" role="presentation">
                                            <span class="bv-content-datetime-dot" aria-hidden="true">·</span>
                                            <span class="bv-content-datetime-stamp">${years_ago}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bv-content-title-container">
                            <h3 class="bv-content-title" itemprop="headline">
                                <a class="bv-secondary-content-link bv-focusable" href="#" data-contentid="147129449">
                                    ${value.title_text ? value.title_text : ''}
                                </a>
                            </h3>
                        </div>
                    </div>
                </div>
                <div class="bv-content-details-offset-off">
                    <div class="bv-content-summary">
                        <div class="bv-content-summary-body" itemprop="reviewBody">
                            <div class="bv-content-summary-body-text">
                                <p>${value.text ? value.text : ''}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bv-content-actions-container">
            <!--div class="bv-secondary-content-actions-container"> <button type="button" aria-label="Comment on review by jonesy." class="bv-content-btn bv-content-secondary-btn bv-focusable bv-mbox-hide-answer-question-button"> Comment </button> </div-->
        </div>
        <div class="bv-secondary-content-list">
          <ol class="bv-content-list bv-content-list-comments">
            ${reviewcomments}
          </ol>
        </div>
    </div>
            </li>`;
          reviews.push(item);
          reviewcomments.length = 0;
        });
        $('#bv-search-results-count').html(function(){
          if(reviews.length == 1) { return '1 Result' } else { return reviews.length + ' Results' };
        });
        return reviews;
      }
      function renderReviews(array_reviews, array_reviewcomments, items_quantity, current_page, only_result = false) {
        let reviews = [];
        let reviewcomments = [];
        let item;
        let gender = '';
        let gender_symbol = '';
        $.each(array_reviews, function(index, value) {
          array_reviewcomments.filter(function(el) {     //Find all comments for current review
            if (value.id == el.id) {
              gender = (typeof(el.Gender) !== 'undefined') ? el.Gender.Value : 'Male';
              gender_symbol = (gender == 'Male') ? '♂' : '♀';
              item =
                `<li class="bv-content-item bv-secondary-content-comment bv-secondary-content-item" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
                  <div class="bv-content-item-avatar-offset bv-content-item-avatar-offset-on">
                    <div class="bv-content-container">
                      <div class="bv-content-core ">
                        <div class="bv-content-header">
                          <div class="bv-author-avatar">
                            <span title="Avatar image" class="bv-author-no-avatar bv-author-gender-" aria-hidden="true">
                              ${gender_symbol}
                            </span>
                          </div>
                          <div class="bv-content-data-summary">
                            <div class="bv-content-header-meta">
                              <div class="bv-content-meta-wrapper">
                                <div class="bv-content-meta" role="presentation">
                                  <div class="bv-content-reference-data bv-content-author-name">
                                    <div class="bv-author">
                                      <span class="bv-author" itemprop="creator">
                                        ${el.name}
                                      </span>
                                    </div>
                                    <div class="bv-content-datetime" role="presentation">
                                      <meta itemprop="dateCreated" content="2020-03-15">
                                      <meta itemprop="datePublished" content="2020-03-15">
                                      <span class="bv-content-datetime-dot" aria-hidden="true">·</span> <span class="bv-content-datetime-stamp"> ago</span>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="bv-content-details-offset-off">
                          <div class="bv-content-summary">
                            <div class="bv-content-summary-body" itemprop="text">
                              <div class="bv-content-summary-body-text">
                                <p>${el.text}</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
              </li>`;
              reviewcomments.push(item);
            }
          });

          let context_data_values = JSON.parse(value.context_data_values);
          let recommend = JSON.parse(value.recommend);
          let recommend_products = [];
          if(recommend.OtherProducts) {
            if(recommend.OtherProducts.Values) {
              for(var i = 0; i < recommend.OtherProducts.Values.length; i++) {
                recommend_products.push(recommend.OtherProducts.Values[i]);
              }
            }
          }
          let recommend_solution;
          if(recommend.recomend == 'I recommend this product.') {
            recommend_solution =
              `<dl class="bv-content-data-recommend-yes">
                <dt class="bv-content-data-label-container">
                  <span class="bv-content-data-icon" aria-hidden="true">✔</span>
                  <span class="bv-content-data-label">Yes</span>,
                </dt>
                <dd class="bv-content-data-value"> I recommend this product. </dd>
              </dl>`;
          } else {
            recommend_solution =
              `<dl class="bv-content-data-recommend-no">
                <dt class="bv-content-data-label-container">
                  <span class="bv-content-data-icon" aria-hidden="true">✘</span>
                  <span class="bv-content-data-label">No</span>,
                </dt>
                <dd class="bv-content-data-value">  I do not recommend this product. </dd>
              </dl>`;
          }
          console.log(recommend);
          let reviews_statistic = JSON.parse(value.statistic);
          gender = (typeof(context_data_values.Gender) !== 'undefined') ? context_data_values.Gender.Value : 'Male';
          gender_symbol = (gender == 'Male') ? '♂' : '♀';
          let years_ago = (current_year - value.data.slice(0, 4) > 1) ? current_year - value.data.slice(0, 4) + ' years ago' : 'a year ago';

          item =
            `<li class="bv-content-item bv-content-top-review bv-content-review" itemprop="review" itemscope="" itemtype="http://schema.org/Review" >
        <div class="bv-author-profile">
          <div class="bv-inline-profile">
            <div class="bv-author-avatar">
              <span title="Avatar image" class="bv-author-no-avatar bv-author-gender-${gender}" aria-hidden="true">
                ${gender_symbol}
              </span>
              <div class="bv-author-avatar-nickname">
                <div class="bv-content-author-name" role="presentation">
                  <button type="button" class="bv-author bv-fullprofile-popup-target bv-focusable">
                    <h3>${value.name}</h3>
                  </button>
                </div>
              </div>
            </div>
            <div class="bv-popup-prosnap-userinfo bv-contains-profile-button">
              <div class="bv-content-author-name" role="presentation">
                <button type="button" class="bv-author bv-fullprofile-popup-target bv-focusable">
                  <h3>${value.name}</h3>
                </button>
              </div>
              <div class="bv-author-location">
                <span>${value.address ? value.address : ''}</span>
              </div>
              <div class="bv-author-userstats">
                <ul class="bv-author-userstats-list" role="presentation">
                  <li class="bv-author-userstats-reviews" role="presentation">
                    <span class="bv-author-userstats-data">${reviews_statistic.Review ? 'Review' : ''} </span>
                    <span class="bv-author-userstats-value">${reviews_statistic.Review ? reviews_statistic.Review : ''}</span>
                  </li>
                  <li class="bv-author-userstats-votes" role="presentation">
                    <span class="bv-author-userstats-data"> ${reviews_statistic.Votes ? 'Votes' : ''} </span>
                    <span class="bv-author-userstats-value">${reviews_statistic.Votes ? reviews_statistic.Votes : ''}</span>
                  </li>
                </ul>
              </div>
              <div class="bv-author-userinfo">
                <ul role="presentation">
                  <li class="bv-author-cdv bv-first " role="presentation">
                    <span class="bv-author-userinfo-data">${context_data_values.HowOftenUse ? context_data_values.HowOftenUse.DimensionLabel : ''}</span>
                    <span class="bv-author-userinfo-value">
                      ${context_data_values.HowOftenUse ? context_data_values.HowOftenUse.ValueLabel : ''}
                    </span>
                  </li>
                  <li class="bv-author-cdv  " role="presentation">
                    <span class="bv-author-userinfo-data">${context_data_values.SeverityOfLoss ? context_data_values.SeverityOfLoss.DimensionLabel : ''}</span>
                    <span class="bv-author-userinfo-value">
                      ${context_data_values.SeverityOfLoss ? context_data_values.SeverityOfLoss.ValueLabel : ''}
                    </span>
                  </li>
                  <li class="bv-author-cdv  " role="presentation">
                    <span class="bv-author-userinfo-data">${context_data_values.SalonProfessional ? context_data_values.SalonProfessional.DimensionLabel : ''}</span>
                    <span class="bv-author-userinfo-value">
                      ${context_data_values.SalonProfessional ? context_data_values.SalonProfessional.ValueLabel : ''}
                    </span>
                  </li>
                  <li class="bv-author-cdv  " role="presentation">
                    <span class="bv-author-userinfo-data">${context_data_values.Age ? context_data_values.Age.DimensionLabel : ''}</span>
                    <span class="bv-author-userinfo-value">
                      ${context_data_values.Age ? context_data_values.Age.ValueLabel : ''}
                    </span>
                  </li>
                  <li class="bv-author-cdv  bv-last" role="presentation">
                    <span class="bv-author-userinfo-data">${context_data_values.Gender ? context_data_values.Gender.DimensionLabel : ''}</span>
                    <span class="bv-author-userinfo-value">
                      ${context_data_values.Gender ? context_data_values.Gender.ValueLabel : ''}
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="bv-content-item-author-profile-offset bv-content-item-author-profile-offset-on">
          <div class="bv-content-container">
            <div class="bv-content-core ">
              <div class="bv-content-header">
                <div class="bv-content-data-summary">
                  <div class="bv-content-header-meta">
                    <span class="bv-content-rating bv-rating-ratio" itemprop="reviewRating" itemscope="" itemtype="http://schema.org/Rating">
                      <meta itemprop="ratingValue" content="${value.rating}">
                      <meta itemprop="bestRating" content="${value.rating}">
                      <span class="bv-rating-stars-container">
                        <abbr title="${value.rating} out of 5 stars." class="bv-rating bv-rating-stars bv-rating-stars-off" aria-hidden="true"> ★★★★★ </abbr>
                        <abbr title="${value.rating} out of 5 stars." class="bv-rating-max bv-rating-stars bv-rating-stars-on bv-width-from-rating-stats-${value.rating * 20}" aria-hidden="true"> ★★★★★ </abbr>
                        <span class="bv-off-screen">${value.rating} out of 5 stars.</span>
                      </span>
                    </span>
                    <div class="bv-content-meta-wrapper">
                      <div class="bv-content-meta" role="presentation">
                        <div class="bv-content-reference-data bv-content-author-name">
                          <button type="button" class="bv-author bv-fullprofile-popup-target bv-focusable" itemprop="author">
                            <h3>${value.name}</h3>
                          </button>
                          <div class="bv-content-datetime" role="presentation">
                            <meta itemprop="dateCreated" content="">
                            <meta itemprop="datePublished" content="-">
                            <span class="bv-content-datetime-dot" aria-hidden="true">·</span>
                            <span class="bv-content-datetime-stamp">
                              ${years_ago}
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="bv-content-title-container">
                    <h3 class="bv-content-title" itemprop="headline">
                      ${value.title_text ? value.title_text : ''}
                    </h3>
                  </div>
                </div>
              </div>
              <div class="bv-content-details-offset-on">
                <div class="bv-content-summary">
                  <div class="bv-content-summary-body" itemprop="reviewBody">
                    <div class="bv-content-summary-body-text">
                      <p>${value.text ? value.text : ''}</p>
                    </div>
                    <div class="bv-content-data">
                      <div class="bv-content-product-questions">
                        <dl class="bv-content-data-product-questions" style="display: ${context_data_values.LengthOfUse ? 'inline!important' : 'none!important'}">
                          <dt class="bv-content-data-label-container">
                            <span class="bv-content-data-label">
                                ${context_data_values.LengthOfUse ? context_data_values.LengthOfUse.DimensionLabel : ''}
                            </span>
                          </dt>
                          <dd class="bv-content-data-value">
                            ${context_data_values.LengthOfUse ? context_data_values.LengthOfUse.ValueLabel : ''}
                          </dd>
                        </dl>
                        <dl class="bv-content-data-product-questions" style="display: ${value.advice_use ? 'inline!important' : 'none!important'}">
                          <dt class="bv-content-data-label-container">
                            <span class="bv-content-data-label">Advice on use:</span>
                          </dt>
                          <dd class="bv-content-data-value">${value.advice_use ? value.advice_use : ''}</dd>
                        </dl>
                      </div>
                      <div class="bv-content-tag-dimensions" style="display: ${recommend.OtherProducts ? 'block!important' : 'none!important'}">
                        <dl class="bv-content-data-tag-dimensions">
                          <dt class="bv-content-data-label-container">
                            <span class="bv-content-data-icon" aria-hidden="true">#</span>
                            <span class="bv-content-data-label">
                              ${recommend.OtherProducts ? recommend.OtherProducts.Label : ''}
                            </span>
                          </dt>
                          ${recommend_products}
                        </dl>
                      </div>
                      ${recommend_solution ? recommend_solution : ''}
                    </div>
                  </div>
                </div>
               </div>
              <div class="bv-content-details-container">
                <div class="bv-secondary-ratings" role="presentation">
                  <dl class="bv-content-secondary-ratings">
                    <dt class="bv-content-secondary-ratings-label" style="display: ${reviews_statistic.Effectiveness ? 'block!important' : 'none!important'}">Effectiveness</dt>
                    <dd class="bv-popup-histogram-ratings-bar" style="display: ${reviews_statistic.Effectiveness ? 'block!important' : 'none!important'}">
                      <span class="bv-content-secondary-ratings-container">
                        <ul class="bv-content-secondary-ratings-bars" role="presentation">
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                        </ul>
                        <span class="bv-content-secondary-ratings-value bv-width-from-rating-stats-${reviews_statistic.Effectiveness ? reviews_statistic.Effectiveness.Value * 20 : 0}"></span>
                        <span class="bv-off-screen">Effectiveness, ${reviews_statistic.Effectiveness ? reviews_statistic.Effectiveness.Value : 0} out of 5</span>
                      </span>
                    </dd>
                    <dt class="bv-content-secondary-ratings-label" style="display: ${reviews_statistic.Reliability ? 'block!important' : 'none!important'}">Reliability</dt>
                    <dd class="bv-popup-histogram-ratings-bar" style="display: ${reviews_statistic.Reliability ? 'block!important' : 'none!important'}">
                      <span class="bv-content-secondary-ratings-container">
                        <ul class="bv-content-secondary-ratings-bars" role="presentation">
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                        </ul>
                        <span class="bv-content-secondary-ratings-value bv-width-from-rating-stats-${reviews_statistic.Reliability ? reviews_statistic.Reliability.Value * 20 : 0}"></span>
                        <span class="bv-off-screen">Reliability, ${reviews_statistic.Reliability ? reviews_statistic.Reliability.Value : 0} out of 5</span>
                      </span>
                    </dd>
                    <dt class="bv-content-secondary-ratings-label" style="display: ${reviews_statistic.EaseOfUse ? 'block!important' : 'none!important'}">Ease of Use</dt>
                    <dd class="bv-popup-histogram-ratings-bar" style="display: ${reviews_statistic.EaseOfUse ? 'block!important' : 'none!important'}">
                      <span class="bv-content-secondary-ratings-container">
                        <ul class="bv-content-secondary-ratings-bars" role="presentation">
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                        </ul>
                        <span class="bv-content-secondary-ratings-value bv-width-from-rating-stats-${reviews_statistic.EaseOfUse ? reviews_statistic.EaseOfUse.Value * 20 : 0}"></span>
                        <span class="bv-off-screen">Ease of Use, ${reviews_statistic.EaseOfUse ? reviews_statistic.EaseOfUse.Value : 0} out of 5</span>
                      </span>
                    </dd>
                    <dt class="bv-content-secondary-ratings-label" style="display: ${reviews_statistic.Discreteness ? 'block!important' : 'none!important'}">Discreteness</dt>
                    <dd class="bv-popup-histogram-ratings-bar" style="display: ${reviews_statistic.Discreteness ? 'block!important' : 'none!important'}">
                      <span class="bv-content-secondary-ratings-container">
                        <ul class="bv-content-secondary-ratings-bars" role="presentation">
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                          <li class="bv-content-secondary-ratings-bar" role="presentation"></li>
                        </ul>
                        <span class="bv-content-secondary-ratings-value bv-width-from-rating-stats-${reviews_statistic.Discreteness ? reviews_statistic.Discreteness.Value * 20 : 0}"></span>
                        <span class="bv-off-screen">Discreteness, ${reviews_statistic.Discreteness ? reviews_statistic.Discreteness.Value : 0} out of 5</span>
                      </span>
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>
          <div class="bv-content-actions-container bv-active-feedback">
            <div class="bv-feedback-container">
              <div class="bv-content-feedback-vote bv-content-feedback-vote-active" role="group" aria-label="Content helpfulness">
               <div class="bv-content-feedback-vote-request">
                 <p>Helpful?</p>
               </div>
                <div class="bv-content-feedback-btn-container">
                  <button type="button" class="bv-content-btn bv-content-btn-feedback-yes bv-focusable">
                    <span aria-hidden="true"> Yes · <span class="bv-content-btn-count" aria-hidden="true">${recommend.positive}</span> </span>
                  </button>
                  <button type="button" class="bv-content-btn bv-content-btn-feedback-no bv-focusable">
                    <span aria-hidden="true"> No · <span class="bv-content-btn-count" aria-hidden="true">${recommend.negative}</span> </span>
                  </button>
                </div>
                <div class="bv-content-feedback-vote bv-content-feedback-vote-active">
                  <button type="button" class="bv-content-report-btn bv-focusable"> Report </button>
                </div>
              </div>
            </div>
          </div>
          <div class="bv-content-actions-container">
            <div class="bv-secondary-content-actions-container">
              <button type="button" aria-label="Comment on review by ${value.name}." class="bv-content-btn bv-content-secondary-btn bv-focusable custom-comment-button" data-review-id="${value.id}"> Comment </button>
            </div>
          </div>
          <div class="bv-secondary-content-list">
            <ol class="bv-content-list bv-content-list-comments">
              ${reviewcomments}
            </ol>
          </div>
        </div>
      </li>`;

          //переписать всю функцию, чтобы она только возвращала массив значений для рендера
          if(!only_result) {
            if (
              (index >= parseInt(items_quantity * (current_page - 1))) &&
              (index < parseInt(current_page * items_quantity))
            ) {
              reviews.push(item);
            }
          } else {
            reviews.push(item);
          }
          reviewcomments.length = 0;
        });
        if(!only_result) {
          $('.custom-list-reviews').html(reviews);
          $('.bv-control-bar-review-count-from').html(parseInt(1 + items_quantity * (current_page - 1)));
          $('.bv-control-bar-review-count-to').html(parseInt((current_page - 1) * items_quantity + reviews.length));
          $('.bv-control-bar-review-count-total').html(array_reviews.length);
        }
        return reviews;
      }
    });
  });
</script>

<div id="custom-reviews" class="container">
  <div>
    <div id="BVRRSearchContainer">
      <div class="bv-cleanslate bv-cv2-cleanslate">
        <div class="bv-shared bv-core-container-103">
          <div class="bv-compat">
            <div class="bv-content-search">
              <div class="bv-masthead">
                <div class="bv-masthead-product bv-summary-bar">
                  <div class="bv-secondary-summary">
                    <dl class="bv-stars-container">
                      <dt class="bv-rating-ratio">
                        <a href="#" class="bv-rating-stars-container bv-focusable" title="Read <?php echo $reviews_sum; ?> Reviews">
                          <span class="bv-rating-stars bv-rating-stars-off" aria-hidden="true"> ★★★★★ </span>
                          <span class="bv-rating-stars-on bv-rating-stars bv-width-from-rating-stats-<?php echo round($statistic['AverageOverallRating'], 1) * 20; ?>" aria-hidden="true"> ★★★★★ </span>
                          <span class="bv-off-screen"><?php echo round($statistic['AverageOverallRating'], 1); ?> out of 5 stars.</span>
                        </a>
                      </dt>
                      <dd class="bv-rating-ratio-number">
                        <span class="bv-rating"><span aria-hidden="true"><?php echo round($statistic['AverageOverallRating'], 1); ?></span></span>
                      </dd>
                      <dd class="bv-rating-ratio-count">
                        <a href="#" class="bv-rating-label bv-text-link bv-focusable"> <?php echo $reviews_sum; ?> Reviews <span class="bv-off-screen">This action will navigate to reviews.</span>
                        </a> </dd>
                    </dl>
                  </div>
                </div>
                <div class="bv-searchbar" role="search" aria-label="Search">
                  <div class="bv-masthead-search bv-submission">
                    <div class="bv-fieldsets">
                      <div class="bv-expand-filter-button-offset-off">
                        <label for="bv-text-field-search-contentSearch1" class="bv-off-screen">Search topics and reviews</label>
                        <span class="bv-search-control-icon" aria-hidden="true">ϙ</span>
                        <input id="bv-text-field-search-contentSearch1" class="bv-text bv-focusable bv-search-text" type="text" name="bv-search" placeholder="Search topics and reviews">
                        <button class="bv-focusable bv-search-clear-icon bv-hidden">
                          <span aria-hidden="true"> ✘ </span>
                          <span class="bv-off-screen">Close</span>
                        </button>
                        <button type="button" class="bv-content-btn bv-content-search-btn bv-focusable" rel="review_search_results">
                          <span class="bv-search-control-icon" aria-hidden="true">ϙ</span>
                          <span class="bv-off-screen">Search</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <ul class="bv-content-product-stats">
                  <li class="bv-content-product-stats-item bv-content-product-stats-item-first bv-content-product-stats-item-reviews">
                    <a href="#" class="bv-content-data-count bv-focusable" data-content-type="review">
                      <span class="bv-content-title"><?php echo $reviews_sum; ?></span>
                      <span class="bv-content-data-label">Reviews</span>
                    </a>
                  </li>
                  <li class="bv-content-product-stats-item bv-content-product-stats-item-questions">
                    <a href="#" class="bv-content-data-count bv-focusable" data-content-type="question">
                      <span class="bv-content-title"><?php echo $questions_sum; ?></span> <span class="bv-content-data-label">Questions</span>
                    </a>
                  </li>
                  <li class="bv-content-product-stats-item bv-content-product-stats-item-last bv-content-product-stats-item-answers">
                    <a href="#" class="bv-content-data-count bv-focusable" data-content-type="question">
                      <span class="bv-content-title"><?php echo $answers_sum; ?></span>
                      <span class="bv-content-data-label">Answers</span>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!---------------------------------------------->
    <div class="bv-cleanslate bv-cv2-cleanslate">
      <div class="bv-shared bv-core-container-103">
        <!-- start header block -->
        <div class="bv-header">
          <div class="bv-action-bar">
            <h2 class="bv-action-bar-header bv-focusable" tabindex="-1">Reviews</h2>
          </div>
          <div class="bv-inline-form-container"></div>
          <div class="bv-section-summary">
            <div class="bv-section-summary-table bv-table-full-width" role="presentation">
              <div class="bv-section-summary-inline bv-flex-container-responsive">
                <div data-bv-v="inlineHistogram:9" class="bv-inline-histogram bv-section-summary-block">
                  <div class="bv-inline-histogram-ratings">
                    <div class="bv-inline-histogram-header">
                      <h3 class="bv-content-title">Rating Snapshot</h3>
                    </div>
                    <p class="bv-histogram-filter-helper">Select a row below to filter reviews.</p>
                    <div class="bv-flex-container-column">
                      <div class="bv-inline-histogram-ratings-star-container bv-flex-container" aria-labelledby="bv-inline-histogram-ratings-star-label-5" role="button">
                        <div class="bv-inline-histogram-ratings-star" data-bv-histogram-rating-value="5"> 5<span class="bv-glyph" aria-hidden="true">★</span> <span class="bv-off-screen">stars</span> </div>
                        <div class="bv-inline-histogram-ratings-bar" data-bv-histogram-rating-value="5" role="presentation" data-bv-histogram-rating-count="<?php echo $rating_general[5]; ?>"> <span class="bv-content-secondary-ratings-container"> <span class="bv-content-secondary-ratings-value bv-width-from-rating-stats-<?php echo $rating_general[5] * 4; ?>"></span> </span> </div>
                        <div class="bv-inline-histogram-ratings-score">
                          <span aria-hidden="true"> <?php echo $rating_general[5]; ?> </span>
                          <span class="bv-off-screen">  <?php echo $rating_general[5]; ?> reviews with 5 stars. </span>
                          <button type="button" id="bv-inline-histogram-ratings-star-label-5" class="bv-focusable bv-off-screen">Select to filter reviews with 5 stars.</button>
                        </div>
                      </div>
                      <div class="bv-inline-histogram-ratings-star-container bv-flex-container" aria-labelledby="bv-inline-histogram-ratings-star-label-4" role="button">
                        <div class="bv-inline-histogram-ratings-star" data-bv-histogram-rating-value="4"> 4<span class="bv-glyph" aria-hidden="true">★</span> <span class="bv-off-screen">stars</span> </div>
                        <div class="bv-inline-histogram-ratings-bar" data-bv-histogram-rating-value="4" role="presentation" data-bv-histogram-rating-count="<?php echo $rating_general[4]; ?>"> <span class="bv-content-secondary-ratings-container"> <span class="bv-content-secondary-ratings-value bv-width-from-rating-stats-<?php echo $rating_general[4] * 4; ?>"></span> </span> </div>
                        <div class="bv-inline-histogram-ratings-score">
                          <span aria-hidden="true"> <?php echo $rating_general[4]; ?> </span>
                          <span class="bv-off-screen"> <?php echo $rating_general[4]; ?> reviews with 4 stars. </span>
                          <button type="button" id="bv-inline-histogram-ratings-star-label-4" class="bv-focusable bv-off-screen">Select to filter reviews with 4 stars.</button>
                        </div>
                      </div>
                      <div class="bv-inline-histogram-ratings-star-container bv-flex-container" aria-labelledby="bv-inline-histogram-ratings-star-label-3" role="button">
                        <div class="bv-inline-histogram-ratings-star" data-bv-histogram-rating-value="3"> 3<span class="bv-glyph" aria-hidden="true">★</span> <span class="bv-off-screen">stars</span> </div>
                        <div class="bv-inline-histogram-ratings-bar" data-bv-histogram-rating-value="3" role="presentation" data-bv-histogram-rating-count="<?php echo $rating_general[3]; ?>"> <span class="bv-content-secondary-ratings-container"> <span class="bv-content-secondary-ratings-value bv-width-from-rating-stats-<?php echo $rating_general[3] * 4; ?>"></span> </span> </div>
                        <div class="bv-inline-histogram-ratings-score">
                          <span aria-hidden="true"> <?php echo $rating_general[3]; ?> </span>
                          <span class="bv-off-screen"> <?php echo $rating_general[3]; ?> reviews with 3 stars. </span>
                          <button type="button" id="bv-inline-histogram-ratings-star-label-3" class="bv-focusable bv-off-screen">Select to filter reviews with 3 stars.</button>
                        </div>
                      </div>
                      <div class="bv-inline-histogram-ratings-star-container bv-flex-container" aria-labelledby="bv-inline-histogram-ratings-star-label-2" role="button">
                        <div class="bv-inline-histogram-ratings-star" data-bv-histogram-rating-value="2"> 2<span class="bv-glyph" aria-hidden="true">★</span> <span class="bv-off-screen">stars</span> </div>
                        <div class="bv-inline-histogram-ratings-bar" data-bv-histogram-rating-value="2" role="presentation" data-bv-histogram-rating-count="<?php echo $rating_general[2]; ?>"> <span class="bv-content-secondary-ratings-container"> <span class="bv-content-secondary-ratings-value bv-width-from-rating-stats-<?php echo $rating_general[2] * 4; ?>"></span> </span> </div>
                        <div class="bv-inline-histogram-ratings-score">
                          <span aria-hidden="true"> <?php echo $rating_general[2]; ?> </span>
                          <span class="bv-off-screen"> <?php echo $rating_general[2]; ?> review with 2 stars. </span>
                          <button type="button" id="bv-inline-histogram-ratings-star-label-2" class="bv-focusable bv-off-screen">Select to filter reviews with 2 stars.</button>
                        </div>
                      </div>
                      <div class="bv-inline-histogram-ratings-star-container bv-flex-container" aria-labelledby="bv-inline-histogram-ratings-star-label-1" role="button">
                        <div class="bv-inline-histogram-ratings-star" data-bv-histogram-rating-value="1"> 1<span class="bv-glyph" aria-hidden="true">★</span> <span class="bv-off-screen">stars</span> </div>
                        <div class="bv-inline-histogram-ratings-bar" data-bv-histogram-rating-value="1" role="presentation" data-bv-histogram-rating-count="<?php echo $rating_general[1]; ?>"> <span class="bv-content-secondary-ratings-container"> <span class="bv-content-secondary-ratings-value bv-width-from-rating-stats-<?php echo $rating_general[1] * 4; ?>"></span> </span> </div>
                        <div class="bv-inline-histogram-ratings-score">
                          <span aria-hidden="true"> <?php echo $rating_general[1]; ?> </span>
                          <span class="bv-off-screen"> <?php echo $rating_general[1]; ?> reviews with 1 star. </span>
                          <button type="button" id="bv-inline-histogram-ratings-star-label-1" class="bv-focusable bv-off-screen">Select to filter reviews with 1 star.</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bv-secondary-rating-summary bv-section-summary-block">
                  <div class="bv-secondary-rating-summary-header">
                    <h3 class="bv-content-title">Average Customer Ratings</h3>
                  </div>
                  <div class="bv-secondary-rating-summary-list bv-table" role="presentation">
                    <div class="bv-secondary-rating-summary-stars bv-table-row">
                      <div class="bv-secondary-rating-summary-id bv-td bv-table-cell" aria-hidden="true">Overall</div>
                      <span class="bv-table-cell">
                        <span class="bv-rating-stars-container">
                          <span class="bv-rating-stars bv-rating-stars-off" aria-hidden="true"> ★★★★★ </span>
                          <span class="bv-rating-stars bv-rating-stars-on bv-width-from-rating-stats-<?php echo round($statistic['AverageOverallRating'], 1) * 20; ?>" aria-hidden="true"> ★★★★★ </span>
                        </span>
                      </span>
                      <span class="bv-secondary-rating-summary-rating bv-table-cell" aria-hidden="true">
                        <?php echo round($statistic['AverageOverallRating'], 1); ?>
                      </span>
                      <span class="bv-off-screen">Overall, average rating value is <?php echo round($statistic['AverageOverallRating'], 1); ?> of 5.</span>
                    </div>
                    <div class="bv-secondary-rating-summary-bars-container bv-table-row">
                      <div class="bv-secondary-rating-summary-id bv-td bv-table-cell" aria-hidden="true">Effectiveness</div> <span class="bv-secondary-rating-summary-container bv-table-cell">
                        <ul class="bv-secondary-rating-summary-bars" role="presentation">
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-value bv-width-from-rating-stats-<?php echo round($statistic['SecondaryRatingsAverages']['Effectiveness']['AverageRating'], 1) * 20; ?>" role="presentation"></li>
                        </ul>
                      </span>
                      <span class="bv-secondary-rating-summary-rating bv-table-cell" aria-hidden="true">
                        <?php echo round($statistic['SecondaryRatingsAverages']['Effectiveness']['AverageRating'], 1); ?>
                      </span>
                      <span class="bv-off-screen">Effectiveness, average rating value is <?php echo round($statistic['SecondaryRatingsAverages']['Effectiveness']['AverageRating'], 1); ?> of 5.</span>
                    </div>
                    <div class="bv-secondary-rating-summary-bars-container bv-table-row">
                      <div class="bv-secondary-rating-summary-id bv-td bv-table-cell" aria-hidden="true">Reliability</div>
                      <span class="bv-secondary-rating-summary-container bv-table-cell">
                        <ul class="bv-secondary-rating-summary-bars" role="presentation">
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-value bv-width-from-rating-stats-<?php echo round($statistic['SecondaryRatingsAverages']['Reliability']['AverageRating'], 1) * 20; ?>" role="presentation"></li>
                        </ul>
                      </span>
                      <span class="bv-secondary-rating-summary-rating bv-table-cell" aria-hidden="true">
                        <?php echo round($statistic['SecondaryRatingsAverages']['Reliability']['AverageRating'], 1); ?>
                      </span>
                      <span class="bv-off-screen">Reliability, average rating value is <?php echo round($statistic['SecondaryRatingsAverages']['Reliability']['AverageRating'], 1); ?> of 5.</span>
                    </div>
                    <div class="bv-secondary-rating-summary-bars-container bv-table-row">
                      <div class="bv-secondary-rating-summary-id bv-td bv-table-cell" aria-hidden="true">Ease of Use</div> <span class="bv-secondary-rating-summary-container bv-table-cell">
                        <ul class="bv-secondary-rating-summary-bars" role="presentation">
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-value bv-width-from-rating-stats-<?php echo round($statistic['SecondaryRatingsAverages']['EaseOfUse']['AverageRating'], 1) * 20; ?>" role="presentation"></li>
                        </ul>
                      </span>
                      <span class="bv-secondary-rating-summary-rating bv-table-cell" aria-hidden="true">
                        <?php echo round($statistic['SecondaryRatingsAverages']['EaseOfUse']['AverageRating'], 1); ?>
                      </span>
                      <span class="bv-off-screen">Ease of Use, average rating value is <?php echo round($statistic['SecondaryRatingsAverages']['EaseOfUse']['AverageRating'], 1); ?> of 5.</span>
                    </div>
                    <div class="bv-secondary-rating-summary-bars-container bv-table-row">
                      <div class="bv-secondary-rating-summary-id bv-td bv-table-cell" aria-hidden="true">Discreteness</div>
                      <span class="bv-secondary-rating-summary-container bv-table-cell">
                        <ul class="bv-secondary-rating-summary-bars" role="presentation">
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-bar bv-width-from-rating-stats-20" role="presentation"></li>
                            <li class="bv-secondary-rating-summary-value bv-width-from-rating-stats-<?php echo round($statistic['SecondaryRatingsAverages']['Discreteness']['AverageRating'], 1) * 20; ?>" role="presentation"></li>
                        </ul>
                      </span>
                      <span class="bv-secondary-rating-summary-rating bv-table-cell" aria-hidden="true">
                        <?php echo round($statistic['SecondaryRatingsAverages']['Discreteness']['AverageRating'], 1); ?>
                      </span>
                      <span class="bv-off-screen">Discreteness, average rating value is <?php echo round($statistic['SecondaryRatingsAverages']['Discreteness']['AverageRating'], 1); ?> of 5.</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="bv-control-bar bv-control-bar-filter-offset">
            <div class="bv-control-bar-count">
              <div class="bv-content-pagination-pages-current bv-focusable" tabindex="-1">
                <span class="bv-control-bar-review-count-from"></span>–<span class="bv-control-bar-review-count-to"></span> of <span class="bv-control-bar-review-count-total"><?php print_r(count($array_reviews)); ?></span> Reviews &nbsp;
              </div>
            </div>
            <div class="bv-relevancy-link-target">
              <span class="bv-sort-relevancy"> <button type="button" class="bv-relevancy-popup-target bv-focusable"> <span aria-hidden="true">?</span> <span class="bv-off-screen">Display a popup with information about Relevancy Sort.</span> </button> </span>
            </div>
            <div class="bv-control-bar-sort">
              <div class="bv-dropdown">
                <div class="bv-dropdown-target" role="menu"> <span id="bv-dropdown-select-reviews" class="bv-dropdown-label"> Sort by: </span>
                  <button type="button" class="bv-focusable" aria-haspopup="true" aria-expanded="false" role="menuitem" aria-labelledby="bv-dropdown-select-reviews bv-dropdown-title-reviews">
                    <span id="bv-dropdown-title-reviews" class="bv-dropdown-title"> Most Recent </span>
                    <span class="bv-dropdown-arrow" aria-hidden="true" role="presentation"> ▼ </span>
                    <span class="bv-off-screen">Menu</span>
                  </button>
                </div>
                <div id="reviews-custom-sortby" class="hide-custom-block">
                  <div class="bv-core-container-103">
                    <div class="bv-select-dropdown bv-shared bv-dropdown-container bv-content-sort-dropdown">
                      <div class="bv-compat">
                        <div class="bv-dropdown">
                          <ul id="bv-dropdown-select-reviews-sortby" role="menu" class="bv-dropdown-active">
                            <li class="bv-dropdown-item bv-focusable" data-bv-dropdown-value="relevancy" tabindex="0" role="menuitem"> Most Relevant </li>
                            <li class="bv-dropdown-item bv-focusable" data-bv-dropdown-value="positive" tabindex="0" role="menuitem"> Highest to Lowest Rating </li>
                            <li class="bv-dropdown-item bv-focusable" data-bv-dropdown-value="negative" tabindex="0" role="menuitem"> Lowest to Highest Rating </li>
                            <li class="bv-dropdown-item bv-dropdown-item-selected bv-focusable" data-bv-dropdown-value="mostRecent" tabindex="0" role="menuitem"> Most Recent </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <button class="bv-content-btn bv-filter-control bv-expand-filter-button bv-focusable bv-filter-control-custom" type="button" tabindex="0">
              <span class="bv-filter-control-icon" aria-hidden="true">≡</span> <span class="bv-filter-control-text">Filter Reviews</span> <span class="bv-off-screen">Clicking on the following button will update the content below</span>
            </button>
          </div>
        </div>
        <!-- end header block -->

        <!-- start filters block -->
        <div id="bv-custom-filters">
          <div class="bv-filter-controls bv-focusable" tabindex="-1">
            <div class="bv-filters" role="menubar">
              <div class="bv-content-filter-select" style="width: auto !important; max-width: 1120px !important;">
                <div class="bv-dropdown" data-bv-filter-for="Rating">
                  <div class="bv-dropdown-target" role="menu">
                    <button type="button" class="bv-focusable" role="menuitem" aria-haspopup="true" aria-expanded="false">
                      <span class="bv-dropdown-arrow" aria-hidden="true" role="presentation"> ▼ </span>
                      <span class="bv-dropdown-title">Rating</span>
                      <span class="bv-off-screen">Menu</span>
                    </button>
                  </div>
                  <label for="bv-dropdown-select-78" class="bv-off-screen"> Filter by Rating </label>
                  <select id="bv-dropdown-select-78" class="bv-select-cleanslate bv-dropdown-select">
                    <option value="1"> 1 star </option>
                    <option value="2"> 2 stars </option>
                    <option value="3"> 3 stars </option>
                    <option value="4"> 4 stars </option>
                    <option value="5"> 5 stars </option>
                  </select>
                  <div id="bv-content-filter-dropdown-Rating" class="hide-custom-block bv-select-dropdown bv-shared bv-dropdown-container">
                    <div class="bv-compat">
                      <div class="bv-dropdown bv-filter-dropdown">
                        <ul role="menu" class="">
                          <li class="bv-dropdown-item bv-focusable" data-bv-dropdown-value="1" tabindex="0" role="menuitem"> <span>1 star</span> </li>
                          <li class="bv-dropdown-item bv-focusable " data-bv-dropdown-value="2" tabindex="0" role="menuitem"> <span>2 stars</span> </li>
                          <li class="bv-dropdown-item bv-focusable " data-bv-dropdown-value="3" tabindex="0" role="menuitem"> <span>3 stars</span> </li>
                          <li class="bv-dropdown-item bv-focusable " data-bv-dropdown-value="4" tabindex="0" role="menuitem"> <span>4 stars</span> </li>
                          <li class="bv-dropdown-item bv-focusable " data-bv-dropdown-value="5" tabindex="0" role="menuitem"> <span>5 stars</span> </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="bv-content-filter-select" style="width: auto !important; max-width: 1120px !important;">
                <div class="bv-dropdown" data-bv-filter-for="My hair loss:">
                  <div class="bv-dropdown-target" role="menu">
                    <button type="button" class="bv-focusable" role="menuitem" aria-haspopup="true" aria-expanded="false">
                      <span class="bv-dropdown-arrow" aria-hidden="true" role="presentation"> ▼ </span>
                      <span class="bv-dropdown-title">My hair loss:</span>
                      <span class="bv-off-screen">Menu</span>
                    </button>
                  </div>
                  <label for="bv-dropdown-select-79" class="bv-off-screen"> Filter by My hair loss: </label>
                  <select id="bv-dropdown-select-79" class="bv-select-cleanslate bv-dropdown-select">
                    <option value="LightThinning"> Light thinning </option>
                    <option value="ModerateThinning"> Moderate thinning </option>
                    <option value="ModeratelySevereThinning"> Moderately severe thinning </option>
                    <option value="SevereHairLoss"> Severe hair loss </option>
                  </select>
                  <div id="bv-content-filter-dropdown-SeverityOfLoss" class="hide-custom-block bv-select-dropdown bv-shared bv-dropdown-container">
                    <div class="bv-compat">
                      <div class="bv-dropdown bv-filter-dropdown">
                        <ul id="bv-content-filter-dropdown-contextdatavalue_SeverityOfLoss" role="menu" class="">
                          <li class="bv-dropdown-item bv-focusable" data-bv-dropdown-value="LightThinning" tabindex="0" role="menuitem"> <span>Light thinning</span> </li>
                          <li class="bv-dropdown-item bv-focusable " data-bv-dropdown-value="ModerateThinning" tabindex="0" role="menuitem"> <span>Moderate thinning</span> </li>
                          <li class="bv-dropdown-item bv-focusable " data-bv-dropdown-value="ModeratelySevereThinning" tabindex="0" role="menuitem"> <span>Moderately severe thinning</span> </li>
                          <li class="bv-dropdown-item bv-focusable " data-bv-dropdown-value="SevereHairLoss" tabindex="0" role="menuitem"> <span>Severe hair loss</span> </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="bv-content-filter-select" style="width: auto !important; max-width: 1120px !important;">
                <div class="bv-dropdown" data-bv-filter-for="Salon Professional:">
                  <div class="bv-dropdown-target" role="menu">
                    <button type="button" class="bv-focusable" role="menuitem" aria-haspopup="true" aria-expanded="false">
                      <span class="bv-dropdown-arrow" aria-hidden="true" role="presentation"> ▼ </span>
                      <span class="bv-dropdown-title">Salon Professional:</span>
                      <span class="bv-off-screen">Menu</span>
                    </button>
                  </div>
                  <label for="bv-dropdown-select-80" class="bv-off-screen"> Filter by Salon Professional: </label>
                  <select id="bv-dropdown-select-80" class="bv-select-cleanslate bv-dropdown-select">
                    <option value="Yes"> Yes </option>
                    <option value="No"> No </option>
                  </select>
                  <div id="bv-content-filter-dropdown-SalonProfessional" class="hide-custom-block bv-select-dropdown bv-shared bv-dropdown-container">
                    <div class="bv-compat">
                      <div class="bv-dropdown bv-filter-dropdown">
                        <ul id="bv-content-filter-dropdown-contextdatavalue_SalonProfessional" role="menu" class="">
                          <li class="bv-dropdown-item bv-focusable" data-bv-dropdown-value="Yes" tabindex="0" role="menuitem"> <span>Yes</span> </li>
                          <li class="bv-dropdown-item bv-focusable " data-bv-dropdown-value="No" tabindex="0" role="menuitem"> <span>No</span> </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="bv-active-filters bv-hidden">
            <div class="bv-active-filters-list-title">Active Filters</div>
            <ul class="bv-active-filters-list">
              <li data-bv-filter-headerid="Rating" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="1" class="bv-active-filter-button bv-focusable" title="Rating">
                  1 star
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="Rating" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="2" class="bv-active-filter-button bv-focusable" title="Rating">
                  2 stars
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="Rating" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="3" class="bv-active-filter-button bv-focusable" title="Rating">
                  3 stars
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="Rating" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="4" class="bv-active-filter-button bv-focusable" title="Rating">
                  4 stars
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="Rating" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="5" class="bv-active-filter-button bv-focusable" title="Rating">
                  5 stars
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="My hair loss:" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="LightThinning" class="bv-active-filter-button bv-focusable" title="My hair loss:">
                  Light thinning
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="My hair loss:" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="ModerateThinning" class="bv-active-filter-button bv-focusable" title="My hair loss:">
                  Moderate thinning
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="My hair loss:" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="ModeratelySevereThinning" class="bv-active-filter-button bv-focusable" title="My hair loss:">
                  Moderately severe thinning
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="My hair loss:" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="SevereHairLoss" class="bv-active-filter-button bv-focusable" title="My hair loss:">
                  Severe hair loss
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="Salon Professional:" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="Yes" class="bv-active-filter-button bv-focusable" title="Salon Professional:">
                  Yes
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li data-bv-filter-headerid="Salon Professional:" class="bv-active-filters-list-item bv-hidden">
                <button type="button" data-bv-filter-option="No" class="bv-active-filter-button bv-focusable" title="Salon Professional:">
                  No <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Remove Filter</span>
                </button>
              </li>
              <li class="bv-active-filters-list-item">
                <button type="button" class="bv-active-filter-button-clear bv-focusable">
                  <span aria-hidden="true">Clear All</span>
                  <span class="bv-close-icon" aria-hidden="true"> ✘ </span>
                  <span class="bv-off-screen">Clear All Filters</span>
                </button>
              </li>
            </ul>
          </div>
        </div>
        <!-- end filters block -->

        <!-- start list of reviews block -->
        <ol class="bv-content-list bv-content-list-reviews custom-list-reviews">

        </ol>
        <!-- end list of reviews block -->

        <!-- start pagination block -->
        <div class="bv-content-pagination">
          <div class="bv-content-pagination-container">
            <div class="bv-control-bar-count">
              <div class="bv-content-pagination-pages-current bv-focusable" tabindex="-1">
                <span class="bv-control-bar-review-count-from"></span>–<span class="bv-control-bar-review-count-to"></span> of <span class="bv-control-bar-review-count-total"><?php print_r(count($array_reviews)); ?></span> Reviews
              </div>
            </div>
            <ul class="bv-content-pagination-buttons" role="presentation">
              <li class="bv-content-pagination-buttons-item bv-content-pagination-buttons-item-previous" role="presentation">
                <a href="#" role="button" class="bv-content-btn bv-content-btn-pages bv-content-btn-pages-last bv-focusable bv-content-btn-pages-active custom-review-link-prev">
                  <span class="bv-off-screen"> Previous Questions </span>
                  <span class="bv-content-btn-pages-prev" aria-hidden="true">   ◄   </span>
                </a>
              </li>
              <li class="bv-content-pagination-buttons-item bv-content-pagination-buttons-item-next" role="presentation">
                <a href="#" role="button" class="bv-content-btn bv-content-btn-pages bv-content-btn-pages-last bv-focusable bv-content-btn-pages-active custom-review-link-next">
                  <span class="bv-off-screen"> Next Questions </span>
                  <span class="bv-content-btn-pages-next" aria-hidden="true">  ►  </span>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <!-- end pagination block -->
      </div>
    </div>
  </div>
</div>

<!-- popup with search results -->
<div class="review_overlay_popup"></div>
<div class="bv-custom-review-popup" id="review_search_results">
  <div class="bv-mboxzone bv-cleanslate bv-cv2-cleanslate bv-mbox-lightbox bv-mbox-opened" style="height: auto !important;">
    <div class="bv-mbox-inner bv-core-container-103 bv-mbox-lightbox">
      <div class="bv-mbox-wrapper bv-mbox-narrow bv-mbox-search bv-mbox-narrow bv-mbox-box">
        <div id="bv-mbox-lightbox-list" class="bv-mbox" role="dialog" aria-modal="true" aria-describedby="bv-content-list-products-wrapper">
          <button type="button" name="Cancel" class="bv-mbox-close bv-focusable" tabindex="0" aria-labelledby="bv-mbox-close-label bv-mbox-breadcrumb-item">
            <span aria-hidden="true"> ✘ </span>
            <span id="bv-mbox-close-label" class="bv-off-screen">Close</span>
          </button>
          <div class="bv-mbox-sidebar bv-sidebar-disabled"></div>
          <div class="bv-mbox-content-container">
            <div class="bv-mbox-injection-container" style="height: 927px !important;">
              <div class="bv-mbox-injection-target bv-mbox-search-content bv-mbox-current">

                <div class="bv-shared bv-core-container-103">
                  <div class="bv-search-content">
                    <div class="bv-header">
                      <div class="bv-content-search">
                        <div class="bv-searchbar" role="search" aria-label="Search">
                          <div class="bv-masthead-search bv-submission">
                            <div class="bv-fieldsets">
                              <div class="bv-expand-filter-button-offset-off">
                                <label for="bv-text-field-search-contentSearch1-lightboxSearch" class="bv-off-screen">Search topics and reviews</label>
                                <span class="bv-search-control-icon" aria-hidden="true">ϙ</span>
                                <input id="bv-text-field-search-contentSearch1-lightboxSearch" class="bv-text bv-focusable bv-search-text" type="text" name="bv-search" placeholder="Search topics and reviews">
                                <button class="bv-focusable bv-search-clear-icon bv-hidden">
                                  <span aria-hidden="true"> ✘ </span>
                                  <span class="bv-off-screen">Close</span>
                                </button>
                                <button type="button" class="bv-content-btn bv-content-search-btn bv-focusable" rel="review_search_results">
                                  <span class="bv-search-control-icon" aria-hidden="true">ϙ</span>
                                  <span class="bv-off-screen">Search</span>
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="bv-action-bar">
                        <h2 class="bv-action-bar-header"> Search Results </h2>
                        <div class="bv-ask-question-container bv-write-container">
                          <!--button type="button" class="bv-ask-question bv-focusable bv-submission-button"> Ask a question  </button-->
                        </div>
                      </div>
                      <div class="bv-inline-form-container"></div>
                      <div class="bv-control-bar">
                        <div class="bv-control-bar-count">
                          <div id="bv-search-results-count" class="bv-content-pagination-pages-current bv-focusable" tabindex="-1"> </div>
                        </div>
                      </div>
                    </div>
                    <div class="bv-content-search-results bv-content-search-results__no-results bv-focusable" tabindex="-1"> Your search returned no results. </div>
                    <div id="bv-content-list-products-wrapper">
                      <ol class="bv-content-list bv-content-list-products popup-custom-search-results">

                      </ol>
                    </div>

                  </div>
                </div>
                <div class="bv-submission bv-submission-image bv-fake-inline">
                  <div class="bv-compat">
                    <form target="bv-submission-target-default6156" action="#" accept-charset="utf-8" method="POST" class="bv-form"> <input type="hidden" name="passkey" value="b5xjo1fw42ctw528lazc88mz8" class="bv-noremember">
                      <input type="hidden" name="action" value="submit" class="bv-noremember">
                      <input type="hidden" name="apiversion" value="5.5" class="bv-noremember">
                      <input type="hidden" name="callback" value="parent.rpc.returnSubmissionResponse" class="bv-noremember">
                      <input type="hidden" name="productid" value="PKIT20010" class="bv-noremember">
                      <input type="hidden" name="campaignid" value="BV_PRODUCT_DISPLAY" class="bv-noremember">
                      <input type="hidden" name="fp" value="" class="bv-noremember">
                      <input type="hidden" name="forceutf8" value="☠" class="bv-noremember">
                      <input type="hidden" name="locale" value="en_US" class="bv-noremember">
                      <input type="hidden" name="contextdatavalue_VerifiedPurchaser" value="False" class="bv-noremember">
                      <input type="hidden" name="displaycode" value="18542-en_us" class="bv-noremember">
                      <input type="hidden" name="hostedauthentication_callbackUrl" value="https://www.toppik.com/catalog/product/view/id/113/s/hair-perfecting-tool-kit-ae15889ee7ad82479638818618afa6e8/category/5/" class="bv-noremember">
                      <input type="hidden" name="sendemailalertwhenpublished" class="bv-noremember bv-form-ignore" value="true">
                      <input type="hidden" name="sendemailalertwhencommented" class="bv-noremember bv-form-ignore" value="true">
                      <input type="hidden" name="sendemailalertwhenanswered" class="bv-noremember bv-form-ignore" value="true">
                      <div class="bv-submission-section">
                      <span id="bv-required-text">
                          <p class="bv-required-fields-text">Required fields are marked with *</p>
                      </span>
                        <span class="bv-off-screen" id="bv-required-text-reader">Required field</span>
                        <div class="bv-fieldsets bv-input-fieldsets">
                          <fieldset class="bv-fieldset bv-fieldset-questionsummary bv-textarea-field bv-nocount">
                            <div class="bv-fieldset-arrowicon"></div>
                            <div class="bv-fieldset-inner"> <label for="bv-textarea-review-search-field-questionsummary" class="bv-fieldset-label-wrapper"> <span class="bv-fieldset-label"> <span class="bv-fieldset-label-text"> Question* </span> <span aria-hidden="false" class="bv-off-screen bv-field-aria-validation"></span> </span> <span class="bv-off-screen">Maximum of 255 characters.</span> </label> <span class="bv-sublabel"> Maximum of 255 characters. </span> <span class="bv-helper"> <span class="bv-helper-label"></span> <span class="bv-helper-icon" aria-hidden="true"> <span class="bv-helper-icon-positive"> ✔ </span> <span class="bv-helper-icon-negative"> ✘ </span> </span> </span> <textarea id="bv-textarea-review-search-field-questionsummary" aria-describedby="bv-required-text" class="bv-text bv-focusable " name="questionsummary" maxlength="255" placeholder="Ask a question..." required="" aria-required="true" style="overflow-wrap: break-word; overflow: hidden !important; height: 90px !important;"></textarea> </div>
                          </fieldset>
                          <fieldset class="bv-fieldset bv-fieldset-usernickname bv-text-field bv-fieldset-small bv-mincount">
                            <div class="bv-fieldset-arrowicon"></div>
                            <div class="bv-fieldset-inner"> <label for="bv-text-revies-search-field-usernickname" class="bv-fieldset-label-wrapper"> <span class="bv-fieldset-label"> <span class="bv-fieldset-label-text"> Nickname* </span> <span aria-hidden="false" class="bv-off-screen bv-field-aria-validation">0 out of a minimum 4 characters used</span> </span> <span class="bv-off-screen">Maximum of 25 characters.</span> </label> <span class="bv-helper"> <span class="bv-helper-label" role="status" aria-live="polite">0 / 4</span> <span class="bv-helper-icon" aria-hidden="true"> <span class="bv-helper-icon-positive"> ✔ </span> <span class="bv-helper-icon-negative"> ✘ </span> </span> </span> <input autocomplete="nickname" id="bv-text-revies-search-field-usernickname" class="bv-text bv-focusable " type="text" name="usernickname" maxlength="25" placeholder="Example: jackie27" value="" required="" aria-required="true"> </div>
                          </fieldset>
                          <fieldset class="bv-fieldset bv-fieldset-userlocation bv-text-field bv-nocount bv-fieldset-small">
                            <div class="bv-fieldset-arrowicon"></div>
                            <div class="bv-fieldset-inner"> <label for="bv-text-review-search-field-userlocation" class="bv-fieldset-label-wrapper"> <span class="bv-fieldset-label"> <span class="bv-fieldset-label-text"> Location </span> <span aria-hidden="false" class="bv-off-screen bv-field-aria-validation"></span> </span> <span class="bv-off-screen">Maximum of 255 characters.</span> </label> <span class="bv-helper"> <span class="bv-helper-label"></span> <span class="bv-helper-icon" aria-hidden="true"> <span class="bv-helper-icon-positive"> ✔ </span> <span class="bv-helper-icon-negative"> ✘ </span> </span> </span> <input id="bv-text-review-search-field-userlocation" class="bv-text bv-focusable " type="text" name="userlocation" maxlength="255" placeholder="Example: New York, NY" value=""> </div>
                          </fieldset>
                          <fieldset class="bv-fieldset bv-fieldset-hostedauthentication_authenticationemail bv-email-field bv-nocount bv-fieldset-small-alone">
                            <div class="bv-fieldset-arrowicon"></div>
                            <div class="bv-fieldset-inner"> <label for="bv-email-field-review-search-hostedauthentication_authenticationemail" class="bv-fieldset-label-wrapper"> <span class="bv-fieldset-label"> <span class="bv-fieldset-label-text"> Email* </span> <span aria-hidden="false" class="bv-off-screen bv-field-aria-validation"></span> </span> <span class="bv-off-screen">Maximum of 255 characters.</span> </label> <span class="bv-helper"> <span class="bv-helper-label" id="bv-invalid-email-for-aria-describedby"></span> <span class="bv-helper-icon" aria-hidden="true"> <span class="bv-helper-icon-positive"> ✔ </span> <span class="bv-helper-icon-negative"> ✘ </span> </span> </span> <input autocomplete="email" id="bv-email-field-review-search-hostedauthentication_authenticationemail" class="bv-text bv-focusable bv-email" type="email" name="hostedauthentication_authenticationemail" maxlength="255" placeholder="Example: youremail@example.com" value="" required="" aria-required="true" aria-describedby="bv-invalid-email-for-aria-describedby"> </div>
                          </fieldset>
                        </div>
                        <div class="bv-fieldsets bv-fieldsets-actions">
                          <div class="bv-form-actions bv-fieldset">
                            <div class="bv-fieldset-arrowicon"></div>
                            <div class="bv-fieldset-inner">
                              <div class="bv-actions-container">
                                <p id="bv-casltext-question" class="bv-fieldset-casltext">You may receive emails regarding this submission. Any emails will include the ability to opt-out of future communications.</p>
                                <button id="bv-search-results-review__question-button" type="button" aria-label="Post Question" aria-describedby="bv-casltext-question" class="bv-form-actions-submit bv-submit bv-focusable bv-submission-button-submit" name="bv-submit-button">Post Question</button>
                                <button type="button" class="bv-form-action bv-cancel bv-submission-button-submit">Cancel</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
